<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STR Investment Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f1117; color: #e1e4e8; }
        .header { background: linear-gradient(135deg, #1a1f2e 0%, #2d1f3d 100%); padding: 32px; border-bottom: 1px solid #30363d; }
        .header h1 { font-size: 28px; font-weight: 700; color: #fff; }
        .header .subtitle { color: #8b949e; font-size: 14px; margin-top: 6px; }
        .back-link { padding: 12px 32px; }
        .back-link a { color: #8b949e; text-decoration: none; font-size: 13px; }
        .back-link a:hover { color: #58a6ff; }
        .tab-bar { display: flex; gap: 0; padding: 0 32px; border-bottom: 1px solid #30363d; background: #161b22; }
        .tab { padding: 14px 24px; font-size: 14px; font-weight: 600; color: #8b949e; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; text-decoration: none; }
        .tab:hover { color: #e1e4e8; background: #1c2128; }
        .tab.active { color: #58a6ff; border-bottom-color: #58a6ff; }
        .market-panel { display: none; }
        .market-panel.active { display: block; }
        .stats-bar { display: flex; gap: 16px; padding: 16px 32px; background: #0f1117; border-bottom: 1px solid #21262d; flex-wrap: wrap; }
        .stat-card { background: #1c2128; border: 1px solid #30363d; border-radius: 8px; padding: 12px 16px; min-width: 130px; }
        .stat-card .label { font-size: 11px; color: #8b949e; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-card .value { font-size: 20px; font-weight: 700; color: #fff; margin-top: 2px; }
        .stat-card .value.green { color: #3fb950; }
        .stat-card .value.blue { color: #58a6ff; }
        .stat-card .value.orange { color: #d29922; }
        .criteria-banner { background: #1c2128; border: 1px solid #30363d; border-left: 3px solid #58a6ff; margin: 16px 32px; padding: 12px 16px; border-radius: 0 8px 8px 0; font-size: 13px; color: #8b949e; }
        .criteria-banner strong { color: #e1e4e8; }
        .criteria-banner.green { border-left-color: #3fb950; }
        .criteria-banner.purple { border-left-color: #bc8cff; }
        .filters { padding: 16px 32px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
        .filters label { font-size: 13px; color: #8b949e; }
        .filters select { background: #1c2128; border: 1px solid #30363d; color: #e1e4e8; padding: 6px 10px; border-radius: 6px; font-size: 13px; }
        .table-container { padding: 0 32px 32px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        th { background: #1c2128; color: #8b949e; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; padding: 10px 12px; text-align: left; cursor: pointer; white-space: nowrap; border-bottom: 2px solid #30363d; position: sticky; top: 0; }
        th:hover { color: #58a6ff; }
        td { padding: 10px 12px; border-bottom: 1px solid #21262d; font-size: 13px; white-space: nowrap; }
        tr:hover { background: #1c2128; }
        .yield-high { color: #3fb950; font-weight: 700; }
        .yield-med { color: #d29922; font-weight: 700; }
        .yield-low { color: #f85149; font-weight: 700; }
        .price { font-weight: 600; color: #fff; }
        .revenue { color: #3fb950; }
        .area-badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; background: #1c2128; color: #8b949e; }
        .no-results { text-align: center; padding: 60px; color: #8b949e; }
        @media (max-width: 768px) {
            .header, .back-link, .tab-bar, .stats-bar, .filters, .table-container, .criteria-banner { padding-left: 16px; padding-right: 16px; }
            .tab { padding: 12px 16px; font-size: 13px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè† STR Investment Tracker</h1>
        <div class="subtitle">Short-term rental for-sale properties across target markets ‚Äî powered by AirDNA</div>
    </div>
    <div class="back-link"><a href="dashboard.html">‚Üê Back to Jaks Dashboard</a></div>

    <div class="tab-bar">
        <a class="tab active" onclick="switchTab('sf',this)">üåâ San Francisco</a>
        <a class="tab" onclick="switchTab('cabin',this)">üèîÔ∏è Sierra Cabin</a>
        <a class="tab" onclick="switchTab('sc',this)">üèñÔ∏è Santa Cruz</a>
    </div>

    <div id="panel-sf" class="market-panel active">
        <div class="criteria-banner"><strong>Search Criteria:</strong> SF market ¬∑ 2+ beds ¬∑ 2+ baths ¬∑ ‚â§$750K ¬∑ Target: South Beach, Alamo Square, Noe Valley, Marina, Daly City, Mission Bay</div>
        <div class="stats-bar" id="stats-sf"></div>
        <div class="filters">
            <label>Sort:</label><select id="sort-sf" onchange="renderTable('sf')"><option value="yield-desc">Yield ‚Üì</option><option value="price-asc">Price ‚Üë</option><option value="price-desc">Price ‚Üì</option><option value="revenue-desc">Revenue ‚Üì</option><option value="occupancy-desc">Occupancy ‚Üì</option></select>
            <label>Max Price:</label><select id="maxprice-sf" onchange="renderTable('sf')"><option value="750000">$750K</option><option value="1000000">$1M</option><option value="99999999">All</option></select>
        </div>
        <div class="table-container"><table><thead><tr><th>Address</th><th>Area</th><th>Score</th><th>Price</th><th>Bed</th><th>Bath</th><th>Sqft</th><th>Yield</th><th>Revenue</th><th>Occ</th><th>ADR</th><th>DOM</th></tr></thead><tbody id="tbody-sf"></tbody></table><div class="no-results" id="noresults-sf" style="display:none">No matching properties</div></div>
    </div>

    <div id="panel-cabin" class="market-panel">
        <div class="criteria-banner green"><strong>Search Criteria:</strong> Northern Sierra Mtns ¬∑ ‚â§$600K ¬∑ Long Barn, Pinecrest, Sonora, Tuolumne, Groveland, Mariposa</div>
        <div class="stats-bar" id="stats-cabin"></div>
        <div class="filters">
            <label>Sort:</label><select id="sort-cabin" onchange="renderTable('cabin')"><option value="yield-desc">Yield ‚Üì</option><option value="price-asc">Price ‚Üë</option><option value="price-desc">Price ‚Üì</option><option value="revenue-desc">Revenue ‚Üì</option><option value="occupancy-desc">Occupancy ‚Üì</option></select>
            <label>Max Price:</label><select id="maxprice-cabin" onchange="renderTable('cabin')"><option value="600000">$600K</option><option value="400000">$400K</option><option value="99999999">All</option></select>
        </div>
        <div class="table-container"><table><thead><tr><th>Address</th><th>Area</th><th>Score</th><th>Price</th><th>Bed</th><th>Bath</th><th>Sqft</th><th>Yield</th><th>Revenue</th><th>Occ</th><th>ADR</th><th>DOM</th></tr></thead><tbody id="tbody-cabin"></tbody></table><div class="no-results" id="noresults-cabin" style="display:none">No matching properties</div></div>
    </div>

    <div id="panel-sc" class="market-panel">
        <div class="criteria-banner purple"><strong>Search Criteria:</strong> Santa Cruz market ¬∑ Capitola, Aptos, Santa Cruz, Watsonville, Felton</div>
        <div class="stats-bar" id="stats-sc"></div>
        <div class="filters">
            <label>Sort:</label><select id="sort-sc" onchange="renderTable('sc')"><option value="yield-desc">Yield ‚Üì</option><option value="price-asc">Price ‚Üë</option><option value="price-desc">Price ‚Üì</option><option value="revenue-desc">Revenue ‚Üì</option><option value="occupancy-desc">Occupancy ‚Üì</option></select>
            <label>Max Price:</label><select id="maxprice-sc" onchange="renderTable('sc')"><option value="99999999">All</option><option value="600000">$600K</option><option value="1000000">$1M</option></select>
        </div>
        <div class="table-container"><table><thead><tr><th>Address</th><th>Area</th><th>Score</th><th>Price</th><th>Bed</th><th>Bath</th><th>Sqft</th><th>Yield</th><th>Revenue</th><th>Occ</th><th>ADR</th><th>DOM</th></tr></thead><tbody id="tbody-sc"></tbody></table><div class="no-results" id="noresults-sc" style="display:none">No matching properties</div></div>
    </div>

    <script>
    var DATA = { sf: null, cabin: null, sc: null };
    var FILES = { sf: 'data.json', cabin: 'cabin-data.json', sc: 'santacruz-data.json' };

    function zillow(addr) {
        return 'https://www.zillow.com/homes/' + addr.replace(/[#,\.]/g, '').replace(/\s+/g, '-') + '_rb/';
    }

    function switchTab(id, el) {
        document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
        document.querySelectorAll('.market-panel').forEach(function(p) { p.classList.remove('active'); });
        el.classList.add('active');
        document.getElementById('panel-' + id).classList.add('active');
    }

    function scoreColor(s) {
        if (s >= 70) return '#3fb950';
        if (s >= 50) return '#d29922';
        return '#f85149';
    }

    function yieldClass(y, market) {
        var high = market === 'cabin' ? 15 : 10;
        var med = market === 'cabin' ? 10 : 7;
        if (y >= high) return 'yield-high';
        if (y >= med) return 'yield-med';
        return 'yield-low';
    }

    function fmtPrice(p) {
        if (p >= 1000000) return '$' + (p/1000000).toFixed(2) + 'M';
        return '$' + Math.round(p/1000) + 'K';
    }

    function renderStats(key) {
        var d = DATA[key];
        if (!d) return;
        var props = d.properties || [];
        var n = props.length;
        var avgY = n ? (props.reduce(function(s,p){return s+(p.yield||0);},0)/n).toFixed(1) : '--';
        var avgP = n ? '$' + Math.round(props.reduce(function(s,p){return s+p.price;},0)/n/1000) + 'K' : '--';
        var avgR = n ? '$' + (props.reduce(function(s,p){return s+(p.revenue||0);},0)/n/1000).toFixed(1) + 'K' : '--';
        var avgO = n ? Math.round(props.reduce(function(s,p){return s+(p.occupancy||0);},0)/n) + '%' : '--';
        var updated = d.lastUpdated ? new Date(d.lastUpdated).toLocaleString() : '--';
        document.getElementById('stats-' + key).innerHTML =
            '<div class="stat-card"><div class="label">Properties</div><div class="value orange">' + n + '</div></div>' +
            '<div class="stat-card"><div class="label">Avg Yield</div><div class="value green">' + avgY + '%</div></div>' +
            '<div class="stat-card"><div class="label">Avg Price</div><div class="value blue">' + avgP + '</div></div>' +
            '<div class="stat-card"><div class="label">Avg Revenue</div><div class="value green">' + avgR + '</div></div>' +
            '<div class="stat-card"><div class="label">Avg Occupancy</div><div class="value">' + avgO + '</div></div>' +
            '<div class="stat-card"><div class="label">Updated</div><div class="value" style="font-size:12px;color:#8b949e">' + updated + '</div></div>';
    }

    function renderTable(key) {
        var d = DATA[key];
        if (!d) return;
        var maxP = parseInt(document.getElementById('maxprice-' + key).value);
        var sortVal = document.getElementById('sort-' + key).value;
        var parts = sortVal.split('-');
        var field = parts[0];
        var dir = parts[1];

        var filtered = (d.properties || []).filter(function(p) { return p.price <= maxP; });
        filtered.sort(function(a, b) {
            var va = a[field] == null ? (dir === 'asc' ? Infinity : -Infinity) : a[field];
            var vb = b[field] == null ? (dir === 'asc' ? Infinity : -Infinity) : b[field];
            return dir === 'asc' ? va - vb : vb - va;
        });

        var tbody = document.getElementById('tbody-' + key);
        var noRes = document.getElementById('noresults-' + key);
        if (!filtered.length) { tbody.innerHTML = ''; noRes.style.display = 'block'; return; }
        noRes.style.display = 'none';

        tbody.innerHTML = filtered.map(function(p) {
            var score = p.hoodScore || p.areaScore || '--';
            var sc = typeof score === 'number' ? scoreColor(score) : '#8b949e';
            var area = p.neighborhood || p.area || '--';
            var yc = yieldClass(p.yield || 0, key);
            return '<tr>' +
                '<td><a href="' + zillow(p.address) + '" target="_blank" style="color:#58a6ff;text-decoration:none;">' + p.address + '</a></td>' +
                '<td><span class="area-badge">' + area + '</span></td>' +
                '<td style="color:' + sc + ';font-weight:700">' + score + '</td>' +
                '<td class="price">' + fmtPrice(p.price) + '</td>' +
                '<td>' + p.beds + '</td>' +
                '<td>' + p.baths + '</td>' +
                '<td>' + (p.sqft ? p.sqft.toLocaleString() : '--') + '</td>' +
                '<td class="' + yc + '">' + (p.yield ? p.yield.toFixed(1) + '%' : '--') + '</td>' +
                '<td class="revenue">' + (p.revenue ? '$' + (p.revenue/1000).toFixed(1) + 'K' : '--') + '</td>' +
                '<td>' + (p.occupancy ? p.occupancy + '%' : '--') + '</td>' +
                '<td>' + (p.adr ? '$' + p.adr : '--') + '</td>' +
                '<td>' + (p.dom || '--') + '</td>' +
                '</tr>';
        }).join('');
    }

    async function loadAll() {
        var keys = ['sf', 'cabin', 'sc'];
        for (var i = 0; i < keys.length; i++) {
            var k = keys[i];
            try {
                var r = await fetch(FILES[k] + '?' + Date.now());
                DATA[k] = await r.json();
            } catch(e) { DATA[k] = { properties: [] }; }
            renderStats(k);
            renderTable(k);
        }
    }

    loadAll();
    </script>
</body>
</html>
