<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèñÔ∏è Santa Cruz STR Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f1117; color: #e1e4e8; }
        .header { background: linear-gradient(135deg, #1a2535 0%, #2d1f2a 100%); padding: 24px 32px; border-bottom: 1px solid #30363d; }
        .header h1 { font-size: 24px; font-weight: 700; color: #fff; }
        .header .subtitle { color: #8b949e; font-size: 14px; margin-top: 4px; }
        .header .updated { color: #58a6ff; font-size: 12px; margin-top: 8px; }
        .nav { padding: 12px 32px; display: flex; gap: 8px; flex-wrap: wrap; }
        .nav a { background: #1c2128; border: 1px solid #30363d; color: #58a6ff; text-decoration: none; padding: 6px 14px; border-radius: 6px; font-size: 13px; }
        .nav a.active { background: #1f2d3d; border-color: #58a6ff; color: #58a6ff; font-weight: 600; }
        .stats-bar { display: flex; gap: 16px; padding: 16px 32px; background: #161b22; border-bottom: 1px solid #30363d; flex-wrap: wrap; }
        .stat-card { background: #1c2128; border: 1px solid #30363d; border-radius: 8px; padding: 12px 16px; min-width: 140px; }
        .stat-card .label { font-size: 11px; color: #8b949e; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-card .value { font-size: 20px; font-weight: 700; color: #fff; margin-top: 2px; }
        .stat-card .value.green { color: #3fb950; }
        .stat-card .value.blue { color: #58a6ff; }
        .stat-card .value.orange { color: #d29922; }
        .criteria-banner { background: #1c2128; border: 1px solid #30363d; border-left: 3px solid #58a6ff; margin: 16px 32px; padding: 12px 16px; border-radius: 0 8px 8px 0; font-size: 13px; color: #8b949e; }
        .criteria-banner strong { color: #e1e4e8; }
        .filters { padding: 16px 32px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
        .filters label { font-size: 13px; color: #8b949e; }
        .filters select { background: #1c2128; border: 1px solid #30363d; color: #e1e4e8; padding: 6px 10px; border-radius: 6px; font-size: 13px; }
        .table-container { padding: 0 32px 32px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        th { background: #1c2128; color: #8b949e; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; padding: 10px 12px; text-align: left; cursor: pointer; user-select: none; white-space: nowrap; border-bottom: 2px solid #30363d; position: sticky; top: 0; }
        th:hover { color: #58a6ff; }
        td { padding: 10px 12px; border-bottom: 1px solid #21262d; font-size: 13px; white-space: nowrap; }
        tr:hover { background: #1c2128; }
        .yield-cell { font-weight: 700; }
        .yield-high { color: #3fb950; }
        .yield-med { color: #d29922; }
        .yield-low { color: #f85149; }
        .price { font-weight: 600; color: #fff; }
        .revenue { color: #3fb950; }
        .area-badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .area-badge.santa-cruz { background: #1b2a3a; color: #58a6ff; }
        .area-badge.aptos { background: #2a1b3a; color: #bc8cff; }
        .area-badge.capitola { background: #1b3a2a; color: #3fb950; }
        .area-badge.watsonville { background: #3a2a1b; color: #d29922; }
        .area-badge.felton { background: #1b3a1b; color: #3fb950; }
        .no-results { text-align: center; padding: 60px; color: #8b949e; }
        .no-results h3 { font-size: 18px; margin-bottom: 8px; color: #e1e4e8; }
        @media (max-width: 768px) {
            .header, .nav, .stats-bar, .filters, .table-container, .criteria-banner { padding-left: 16px; padding-right: 16px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèñÔ∏è Santa Cruz STR Property Tracker</h1>
        <div class="subtitle">Capitola / Aptos / Santa Cruz ‚Äî Coastal STR investment properties</div>
        <div class="updated" id="lastUpdated">Loading...</div>
    </div>

    <div class="nav">
        <a href="dashboard.html">üìä Dashboard</a>
        <a href="index.html">üè† SF STR</a>
        <a href="cabin.html">üèîÔ∏è Cabin STR</a>
        <a href="santacruz.html" class="active">üèñÔ∏è Santa Cruz STR</a>
    </div>

    <div class="criteria-banner">
        <strong>Search Criteria:</strong> Santa Cruz market ¬∑ All for-sale properties with STR potential
        <br><strong>Target areas:</strong> Capitola, Aptos, Santa Cruz, Watsonville, Felton
    </div>

    <div class="stats-bar" id="statsBar"></div>

    <div class="filters">
        <label>Sort by:</label>
        <select id="sortBy" onchange="renderTable()">
            <option value="yield-desc">Yield (High‚ÜíLow)</option>
            <option value="yield-asc">Yield (Low‚ÜíHigh)</option>
            <option value="price-asc">Price (Low‚ÜíHigh)</option>
            <option value="price-desc">Price (High‚ÜíLow)</option>
            <option value="revenue-desc">Revenue (High‚ÜíLow)</option>
            <option value="occupancy-desc">Occupancy (High‚ÜíLow)</option>
            <option value="adr-desc">ADR (High‚ÜíLow)</option>
        </select>
        <label>Max Price:</label>
        <select id="maxPrice" onchange="renderTable()">
            <option value="999999999">All</option>
            <option value="600000">$600K</option>
            <option value="800000">$800K</option>
            <option value="1000000">$1M</option>
            <option value="1500000">$1.5M</option>
        </select>
        <label>Area:</label>
        <select id="areaFilter" onchange="renderTable()">
            <option value="all">All Areas</option>
            <option value="Santa Cruz">Santa Cruz</option>
            <option value="Aptos">Aptos</option>
            <option value="Watsonville">Watsonville</option>
            <option value="Felton">Felton</option>
            <option value="Los Gatos">Los Gatos</option>
        </select>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Address</th>
                    <th>Area</th>
                    <th>Price</th>
                    <th>Bed</th>
                    <th>Bath</th>
                    <th>Sqft</th>
                    <th>Yield</th>
                    <th>Revenue</th>
                    <th>Occupancy</th>
                    <th>ADR</th>
                    <th>DOM</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
        <div class="no-results" id="noResults" style="display:none;">
            <h3>No properties match your filters</h3>
            <p>Try expanding your price range or area filter</p>
        </div>
    </div>

    <script>
    let DATA = { properties: [], market: {} };

    function zillow(addr) {
        const slug = addr.replace(/[#,\.]/g, '').replace(/\s+/g, '-');
        return `https://www.zillow.com/homes/${slug}_rb/`;
    }

    async function loadData() {
        try {
            const resp = await fetch('santacruz-data.json?' + Date.now());
            DATA = await resp.json();
        } catch (e) {
            console.error('Failed to load data:', e);
        }
        render();
    }

    function render() {
        document.getElementById('lastUpdated').textContent = DATA.lastUpdated 
            ? `Last updated: ${new Date(DATA.lastUpdated).toLocaleString()}`
            : 'No data yet';

        const props = DATA.properties || [];
        const avgYield = props.length ? (props.reduce((s,p) => s + p.yield, 0) / props.length).toFixed(1) : '--';
        const avgPrice = props.length ? '$' + Math.round(props.reduce((s,p) => s + p.price, 0) / props.length / 1000) + 'K' : '--';
        const avgRev = props.length ? '$' + (props.reduce((s,p) => s + p.revenue, 0) / props.length / 1000).toFixed(1) + 'K' : '--';
        const avgOcc = props.length ? Math.round(props.reduce((s,p) => s + p.occupancy, 0) / props.length) + '%' : '--';

        document.getElementById('statsBar').innerHTML = `
            <div class="stat-card"><div class="label">Properties Found</div><div class="value orange">${props.length}</div></div>
            <div class="stat-card"><div class="label">Avg Yield</div><div class="value green">${avgYield}%</div></div>
            <div class="stat-card"><div class="label">Avg Price</div><div class="value blue">${avgPrice}</div></div>
            <div class="stat-card"><div class="label">Avg Revenue</div><div class="value green">${avgRev}</div></div>
            <div class="stat-card"><div class="label">Avg Occupancy</div><div class="value">${avgOcc}</div></div>
            <div class="stat-card"><div class="label">Market</div><div class="value" style="font-size:14px;">Santa Cruz</div></div>
        `;
        renderTable();
    }

    function renderTable() {
        const maxPrice = parseInt(document.getElementById('maxPrice').value);
        const areaFilter = document.getElementById('areaFilter').value;
        const sortBy = document.getElementById('sortBy').value;

        let filtered = DATA.properties.filter(p => {
            if (p.price > maxPrice) return false;
            if (areaFilter !== 'all' && p.area !== areaFilter) return false;
            return true;
        });

        const [field, dir] = sortBy.split('-');
        filtered.sort((a, b) => {
            let va = a[field], vb = b[field];
            if (va == null) va = dir === 'asc' ? Infinity : -Infinity;
            if (vb == null) vb = dir === 'asc' ? Infinity : -Infinity;
            return dir === 'asc' ? va - vb : vb - va;
        });

        const tbody = document.getElementById('tableBody');
        const noResults = document.getElementById('noResults');
        if (filtered.length === 0) { tbody.innerHTML = ''; noResults.style.display = 'block'; return; }
        noResults.style.display = 'none';

        const ac = a => a === 'Santa Cruz' ? 'santa-cruz' : a === 'Aptos' ? 'aptos' : a === 'Watsonville' ? 'watsonville' : a === 'Felton' ? 'felton' : 'capitola';

        tbody.innerHTML = filtered.map(p => {
            const yc = p.yield >= 10 ? 'yield-high' : p.yield >= 7 ? 'yield-med' : 'yield-low';
            return `<tr>
                <td><a href="${zillow(p.address)}" target="_blank" style="color:#58a6ff;text-decoration:none;">${p.address}</a></td>
                <td><span class="area-badge ${ac(p.area)}">${p.area}</span></td>
                <td class="price">$${p.price >= 1000000 ? (p.price/1000000).toFixed(2) + 'M' : (p.price/1000).toFixed(0) + 'K'}</td>
                <td>${p.beds}</td>
                <td>${p.baths}</td>
                <td>${p.sqft ? p.sqft.toLocaleString() : '--'}</td>
                <td class="yield-cell ${yc}">${p.yield.toFixed(1)}%</td>
                <td class="revenue">$${(p.revenue/1000).toFixed(1)}K</td>
                <td>${p.occupancy}%</td>
                <td>$${p.adr}</td>
                <td>${p.dom || '--'}</td>
            </tr>`;
        }).join('');
    }

    loadData();
    </script>
</body>
</html>
